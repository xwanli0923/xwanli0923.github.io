<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-CN"><generator uri="https://jekyllrb.com/" version="4.3.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="zh-CN" /><updated>2023-02-20T16:59:07+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">ä¸‡é‡Œåšå®¢</title><subtitle>åŠŸä¸å”æ </subtitle><author><name>é‚¢ä¸‡é‡Œ</name></author><entry><title type="html">åœ¨ Fedora CoreOS ä¸­è¿è¡Œå®¹å™¨</title><link href="http://localhost:4000/2023/02/20/running-a-container-with-fcos.html" rel="alternate" type="text/html" title="åœ¨ Fedora CoreOS ä¸­è¿è¡Œå®¹å™¨" /><published>2023-02-20T00:00:00+08:00</published><updated>2023-02-20T00:00:00+08:00</updated><id>http://localhost:4000/2023/02/20/running-a-container-with-fcos</id><content type="html" xml:base="http://localhost:4000/2023/02/20/running-a-container-with-fcos.html"><![CDATA[<p><img src="/assets/images/2023-02-20/welcomefedoracoreos.jpg" alt="Fedoraject-Anaconda-installer" /></p>

<p><em>[å›¾ç‰‡æ¥æºï¼š<a href="https://docs.fedoraproject.org/en-US/fedora-coreos/_images/welcomefedoracoreos.jpg">Fedora Docs</a> ]</em></p>

<p><em>ä½œè€…: é‚¢ä¸‡é‡Œ</em></p>

<p>Fedora CoreOS is an automatically updating, minimal, monolithic, container-focused operating system, designed for clusters but also operable standalone, optimized for Kubernetes but also great without it. It aims to combine the best of both CoreOS Container Linux and Fedora Atomic Host, integrating technology like Ignition from Container Linux with rpm-ostree and SELinux hardening from Project Atomic. Its goal is to provide the best container host to run containerized workloads securely and at scale.<br />
<em>ğŸª§æ‘˜è‡ª <a href="https://docs.fedoraproject.org/jp/fedora-coreos/">Fedora CoreOS Documentation</a></em></p>

<h1 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h1>

<p>éšç€äº‘åŸç”Ÿçš„å¿«é€Ÿå‘å±•ï¼Œå°†ä¸šåŠ¡ç³»ç»Ÿéƒ¨ç½²ä»¥ <strong>Kubernetes</strong> è¿™ç§å®¹å™¨ç¼–æ’ç³»ç»Ÿä¸ºä¸»çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œåº•å±‚æ“ä½œç³»ç»Ÿç”±äºæ— æ³•å®ç°ä¸€è‡´æ€§é…ç½®è€Œå¯¼è‡´çš„é—®é¢˜é¢‘é¢‘å‡ºç°ï¼Œå› æ­¤ä¸€ä¸ªä¸“é—¨ç”¨äºè¿è¡Œå®¹å™¨ï¼Œä½¿ç”¨äº†å®¹å™¨çš„è®¾è®¡ç†å¿µçš„æ“ä½œç³»ç»Ÿåº”è¿è€Œç”Ÿï¼Œå¸¸è§çš„å®¹å™¨æ“ä½œç³»ç»Ÿæœ‰ <strong>Fedora CoreOS</strong> ã€ <strong>Red Hat CoreOS</strong> ã€<strong>RancherOS</strong> ã€<strong>Photon</strong> ã€ <strong>KubeOS</strong> ç­‰</p>

<p>æœ¬æ–‡ä½¿ç”¨ <strong>Fedora CoreOS</strong> ä½œä¸ºæ ·ä¾‹è¿è¡Œä¸€ä¸ªç®€å•çš„å®¹å™¨ã€‚</p>

<p><em>æ‰©å±•çŸ¥è¯†</em>ï¼š <strong>Fedora</strong> åœ¨æ—©æœŸæœ‰ä¸€ä¸ªä¸“é—¨è¿è¡Œå®¹å™¨çš„äº§å“ <strong>Atomic</strong> ï¼Œåæ¥çº¢å¸½å°† <strong>CoreOS</strong> æ”¶è´­ä¹‹åï¼Œçº¢å¸½å°† <strong>Atomic</strong> å’Œ <strong>CoreOS</strong> åˆå¹¶ä¸º <strong>Fedora CoreOS</strong> ï¼Œç®€ç§° <em>fcos</em>ï¼Œå•†ä¸šç‰ˆæœ¬ä¸º<strong>Red Hat CoreOS</strong>ï¼Œç®€ç§°<em>RHCOS</em>ã€‚</p>

<h1 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h1>

<p>æ‚¨éœ€è¦å®ç°å‡†å¤‡ä¸€å°å’Œå°†æ¥éƒ¨ç½² <strong>FCOS</strong> èƒ½å¤Ÿé€šä¿¡çš„ä¸€ä¸ª web æœåŠ¡å™¨ï¼Œç”¨ç”¨äºå­˜æ”¾ <strong>ignition</strong> æ–‡ä»¶ã€‚</p>

<ul>
  <li>æˆ‘è¿™é‡Œä½¿ç”¨çš„ä¸€å°æ¡Œé¢ç‰ˆæœ¬ Linux å‘è¡Œç‰ˆï¼š<strong>Linux Mint 21.1</strong></li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-29-31.png" alt="" /></p>

<ul>
  <li>ç½‘ç»œä¿¡æ¯å¦‚ä¸‹</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ ip addr show ens37
3: ens37: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:0c:29:d9:67:b5 brd ff:ff:ff:ff:ff:ff
    altname enp2s5
    inet 172.25.254.228/24 brd 172.25.254.255 scope global dynamic noprefixroute ens37
       valid_lft 155sec preferred_lft 155sec
    inet6 fe80::712d:e12e:ba61:7545/64 scope <span class="nb">link </span>noprefixroute 
       valid_lft forever preferred_lft forever
</code></pre></div></div>

<ul>
  <li>å¹¶ä¸”æˆ‘å·²ç»å‡†å¤‡å¥½äº† Web æœåŠ¡å™¨</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ <span class="nb">sudo </span>systemctl status apache2.service
â— apache2.service - The Apache HTTP Server
     Loaded: loaded <span class="o">(</span>/lib/systemd/system/apache2.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
     Active: active <span class="o">(</span>running<span class="o">)</span> since Sun 2023-02-19 22:33:33 MST<span class="p">;</span> 1h 58min ago
       Docs: https://httpd.apache.org/docs/2.4/
    Process: 947 <span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/apachectl start <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
    Process: 5087 <span class="nv">ExecReload</span><span class="o">=</span>/usr/sbin/apachectl graceful <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
   Main PID: 1031 <span class="o">(</span>apache2<span class="o">)</span>
      Tasks: 55 <span class="o">(</span>limit: 2182<span class="o">)</span>
     Memory: 6.5M
        CPU: 289ms
     CGroup: /system.slice/apache2.service
             â”œâ”€1031 /usr/sbin/apache2 <span class="nt">-k</span> start
             â”œâ”€5105 /usr/sbin/apache2 <span class="nt">-k</span> start
             â””â”€5106 /usr/sbin/apache2 <span class="nt">-k</span> start

Feb 19 22:33:31 workstation.lab.example.net systemd[1]: Starting The Apache HTTP Server...
Feb 19 22:33:33 workstation.lab.example.net systemd[1]: Started The Apache HTTP Server.
Feb 20 00:00:00 workstation.lab.example.net systemd[1]: Reloading The Apache HTTP Server...
Feb 20 00:00:00 workstation.lab.example.net systemd[1]: Reloaded The Apache HTTP Server.


â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ ss <span class="nt">-tplna</span> | <span class="nb">grep</span> :8080
LISTEN 0      511                 <span class="k">*</span>:8080               <span class="k">*</span>:<span class="k">*</span>           
</code></pre></div></div>

<ul>
  <li>
    <p>è¯·äº‹å…ˆä¸‹è½½ <strong>FCOS</strong> é•œåƒ</p>

    <ul>
      <li>
        <p>æœ€æ–°ç‰ˆæœ¬Fedoraä¸‹è½½ç«™ç‚¹ <a href="https://getfedora.org/">https://getfedora.org/</a></p>
      </li>
      <li>
        <p>æœ¬æ–‡ä½¿ç”¨é•œåƒçš„é“¾æ¥ <a href="https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/37.20230122.3.0/x86_64/fedora-coreos-37.20230122.3.0-live.x86_64.iso">https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/37.20230122.3.0/x86_64/fedora-coreos-37.20230122.3.0-live.x86_64.iso</a></p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="1-åœ¨linuxmintä¸­å®‰è£…butane">1. åœ¨<strong>LinuxMint</strong>ä¸­å®‰è£…<strong>butane</strong></h3>

<p><strong>Fedora</strong>ç¤¾åŒºä¸º Linux å®¢æˆ·ç«¯æä¾›äº†ä¸¤ç§æ–¹å¼æ¥å®‰è£…<strong>butane</strong>å·¥å…·ï¼Œè¿™ç§å·¥å…·å¯ä»¥å°†ç¼–å†™å¥½çš„<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶è½¬ä¸º JSON æ ¼å¼ï¼›ç¬¬ä¸€ç§ä½¿ç”¨ <strong>dnf</strong> è¿›è¡Œå®‰è£…ï¼Œç¬¬äºŒç§ä½¿ç”¨ <strong>brew</strong>å®‰è£…ï¼›æˆ‘ä»¬é‡‡ç”¨ <strong>brew</strong>æ–¹å¼å®‰è£…</p>

<ul>
  <li>é¦–å…ˆå®‰è£… <strong>brew</strong> å·¥å…·</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ /bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<ul>
  <li>é…ç½® <strong>brew</strong> å·¥å…·</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ <span class="o">(</span><span class="nb">echo</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"'</span><span class="o">)</span> <span class="o">&gt;&gt;</span> /home/devops/.bashrc

â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯  <span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential

â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯  <span class="nb">source</span> ~/.bashrc

â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯  brew <span class="nb">install </span>gcc
</code></pre></div></div>

<ul>
  <li>ä½¿ç”¨ <strong>brew</strong>å®‰è£… <strong>butane</strong></li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯  brew <span class="nb">install </span>butane
</code></pre></div></div>

<ul>
  <li>ç”Ÿæˆå¯†é’¥å¯¹</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯  ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-N</span> <span class="s1">''</span> <span class="nt">-b</span> 2048 <span class="nt">-f</span> ~/.ssh/id_rsa <span class="nt">-q</span>

â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ <span class="nb">cat</span> ~/.ssh/id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCms5d2FmXtXmhSJIezA812ymi4uT3XELM508FkD/4Pv+wXE0gl/aN7bPCVD6qxpHbXHgj6nWTIoej3pZeEYEOGlXua98tSyu3aaBfj5UIY5eF8838EireSJSVZPj3k6aB8ryL5W4G/4buwW6IzvvRRrknJDsFvajs5LvLiLUNrag/i9PIQZ0VZZQbLhx0/ZJCDAFIREpXuyPM+FsS2TYOnRZNeD/2IFscI05Xe4mA0NdI8Fzfji0c0dIBKYDD3mKFQ7qhvaLD7Q2v6I9hyfe5nZqAcaPW2f+rfsycdkhSOCZNQ7DbfWm7ILbAz+FFAUuzrMseytoEfOXbemQpgM7q5hIJgZkLOb38o4e6uXH+A43svE5U1tWKpaX2yRDSvi4rP9Nae0SdrkBzFG9dPzQvbEFYla+6BiFh+iRnnOLegni1WT9GjOonKay0/XCxH9s8mlXK1hKd/jgWf9j/BTkAOb++NZDCV5fsfGG+wnMUAcc44U6MNij+w3n4u6BiqAB0<span class="o">=</span> devops@workstation.lab.example.net
</code></pre></div></div>

<h3 id="2-æŸ¥çœ‹fcosèŠ‚ç‚¹ç½‘ç»œç¡¬ä»¶ç­‰ä¿¡æ¯">2. æŸ¥çœ‹FCOSèŠ‚ç‚¹ç½‘ç»œã€ç¡¬ä»¶ç­‰ä¿¡æ¯</h3>

<ul>
  <li>åˆ›å»ºä¸€å°è™šæ‹Ÿæœºï¼Œè®¾ç½®ä¸º <em>UEFI</em> ï¼Œä½¿ç”¨ <strong>fcos</strong> å…‰ç›˜å¼•å¯¼,ç•Œé¢å¦‚ä¸‹</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-51-53.png" alt="" /></p>

<ul>
  <li>æŸ¥çœ‹ç½‘å¡å</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-53-04.png" alt="" /></p>

<ul>
  <li>
    <p>å¦‚æœæ‚¨çš„è™šæ‹Ÿæœºæ²¡æœ‰é€šè¿‡<strong>DHCP</strong>è·å–åœ°å€,éœ€è¦æ‰‹åŠ¨è®¾ç½®ç½‘ç»œä¿¡æ¯ï¼Œç¡®ä¿å¯ä»¥å’Œæä¾›<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶çš„ä¸»æœºè¿›è¡Œé€šä¿¡</p>

    <ul>
      <li>è®¾ç½®ç½‘ç»œçš„å‘½ä»¤ä¸º <code class="language-plaintext highlighter-rouge">sudo nmtui</code></li>
    </ul>

    <p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-55-12.png" alt="" /></p>
  </li>
</ul>

<hr />
<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-55-42.png" alt="" /></p>

<hr />
<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-56-21.png" alt="" /></p>

<hr />

<ul>
  <li>æ¿€æ´»ç½‘ç»œè¿æ¥</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-57-04.png" alt="" /></p>

<hr />
<ul>
  <li>
    <p>ä½¿çŠ¶æ€ç”± <code class="language-plaintext highlighter-rouge">Deactivate</code> å˜ä¸º <code class="language-plaintext highlighter-rouge">Activate</code>ï¼Œå†å˜ä¸º <code class="language-plaintext highlighter-rouge">Deactivate</code>
  <img src="/assets/images/2023-02-20/Snipaste_2023-02-20_15-58-00.png" alt="" /></p>
  </li>
  <li>
    <p>æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆ</p>
  </li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-05-57.png" alt="" /></p>

<ul>
  <li>æ£€æŸ¥ç£ç›˜ä¿¡æ¯</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-09-19.png" alt="" /></p>

<h3 id="3-å¼€å§‹ç¼–å†™ignitionæ–‡ä»¶">3. å¼€å§‹ç¼–å†™<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶</h3>

<ul>
  <li>åˆ›å»ºæ–‡ä»¶ <code class="language-plaintext highlighter-rouge">fcos36.yml</code>ï¼Œ æ ¹æ®éœ€è¦ç¼–å†™çš„<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">variant</span><span class="pi">:</span> <span class="s">fcos</span>
<span class="na">version</span><span class="pi">:</span> <span class="s">1.4.0</span>
<span class="c1"># åˆ›å»ºç”¨æˆ· core å¹¶ä½¿ç”¨ ssh è®¤è¯ç™»å½•</span>
<span class="na">passwd</span><span class="pi">:</span>
  <span class="na">users</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">core</span>
      <span class="na">ssh_authorized_keys</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCms5d2FmXtXmhSJIezA812ymi4uT3XELM508FkD/4Pv+wXE0gl/aN7bPCVD6qxpHbXHgj6nWTIoej3pZeEYEOGlXua98tSyu3aaBfj5UIY5eF8838EireSJSVZPj3k6aB8ryL5W4G/4buwW6IzvvRRrknJDsFvajs5LvLiLUNrag/i9PIQZ0VZZQbLhx0/ZJCDAFIREpXuyPM+FsS2TYOnRZNeD/2IFscI05Xe4mA0NdI8Fzfji0c0dIBKYDD3mKFQ7qhvaLD7Q2v6I9hyfe5nZqAcaPW2f+rfsycdkhSOCZNQ7DbfWm7ILbAz+FFAUuzrMseytoEfOXbemQpgM7q5hIJgZkLOb38o4e6uXH+A43svE5U1tWKpaX2yRDSvi4rP9Nae0SdrkBzFG9dPzQvbEFYla+6BiFh+iRnnOLegni1WT9GjOonKay0/XCxH9s8mlXK1hKd/jgWf9j/BTkAOb++NZDCV5fsfGG+wnMUAcc44U6MNij+w3n4u6BiqAB0=</span>

<span class="na">storage</span><span class="pi">:</span>
<span class="c1"># åˆ›å»ºç³»ç»Ÿçš„æ ¹åˆ†åŒºä¸º 8GB</span>
  <span class="na">disks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">device</span><span class="pi">:</span> <span class="s">/dev/disk/by-id/coreos-boot-disk</span>
      <span class="na">wipe_table</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">partitions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">number</span><span class="pi">:</span> <span class="m">4</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">root</span>
          <span class="na">size_mib</span><span class="pi">:</span> <span class="m">8192</span>
          <span class="na">resize</span><span class="pi">:</span> <span class="no">true</span>
        <span class="pi">-</span> <span class="na">size_mib</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">var</span>
<span class="c1"># é…ç½®ç½‘å¡ ens160 çš„ç½‘ç»œä¿¡æ¯</span>
  <span class="na">files</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/NetworkManager/system-connections/ens160.nmconnection</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="m">0600</span>
      <span class="na">contents</span><span class="pi">:</span>
        <span class="na">inline</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">[connection]</span>
          <span class="s">id=ens160</span>
          <span class="s">type=ethernet</span>
          <span class="s">interface-name=ens160</span>
          <span class="s">[ipv4]</span>
          <span class="s">address1=172.25.254.221/24;172.25.254.254</span>
          <span class="s">dns=8.8.8.8;</span>
          <span class="s">dns-search=lab.example.net</span>
          <span class="s">may-fail=false</span>
          <span class="s">method=manual</span>
<span class="c1"># è®¾ç½®ä¸»æœºå</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/hostname</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="m">0644</span>
      <span class="na">contents</span><span class="pi">:</span>
        <span class="na">inline</span><span class="pi">:</span> <span class="s">fcos.xwanli0923.github.io</span>
<span class="c1"># åˆ›å»ºå®¹å™¨æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨ä½ç½® </span>
  <span class="na">directories</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/opt/website/html</span>
      <span class="na">overwrite</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># åˆ›å»ºå®¹å™¨æ‰€éœ€çš„æ–‡ä»¶</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/opt/website/html/index.html</span>
      <span class="na">overwrite</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">contents</span><span class="pi">:</span>
        <span class="na">inline</span><span class="pi">:</span> <span class="s">&lt;h1&gt;Hello, I am Xing Wanli. Welcome to cloudshelledu!&lt;/h1&gt;</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="m">0644</span>
<span class="c1"># æ›´æ”¹æ—¶åŒº</span>
<span class="err">  </span><span class="na">links</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/localtime</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">../usr/share/zoneinfo/Asia/Shanghai</span>
<span class="c1"># åˆ›å»ºæŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿ</span>
  <span class="na">filesystems</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/var</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">/dev/disk/by-partlabel/var</span>
      <span class="na">format</span><span class="pi">:</span> <span class="s">ext4</span>
      <span class="na">with_mount_unit</span><span class="pi">:</span> <span class="no">true</span>
<span class="c1"># åˆ›å»ºä¸€ä¸ª Systemd Unit æ–‡ä»¶ï¼Œç”¨äºå¼€æœºè¿è¡Œ podman å®¹å™¨ï¼Œå®¹å™¨åä¸º mywebserver ï¼Œæ˜ å°„ä¸»æœºç«¯å£ä¸º 80 </span>
<span class="na">systemd</span><span class="pi">:</span>
  <span class="na">units</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">container-mywebserver.service</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">contents</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">[Unit]</span>
        <span class="s">Description=Podman container-mywebserver.service</span>
        <span class="s">Documentation=man:podman-generate-systemd(1)</span>
        <span class="s">Wants=network-online.target</span>
        <span class="s">After=network-online.target</span>
        <span class="s">RequiresMountsFor=%t/containers</span>

        <span class="s">[Service]</span>
        <span class="s">Environment=PODMAN_SYSTEMD_UNIT=%n</span>
        <span class="s">Restart=on-failure</span>
        <span class="s">TimeoutStopSec=70</span>
        <span class="s">ExecStartPre=/bin/rm -f %t/%n.ctr-id</span>
        <span class="s">ExecStart=/usr/bin/podman run --cidfile=%t/%n.ctr-id --sdnotify=conmon --cgroups=no-conmon --rm --replace -d --name mywebserver -v /opt/website/html:/usr/local/apache2/htdocs:Z -p 80:80 docker.io/library/httpd:latest</span>
        <span class="s">ExecStop=/usr/bin/podman stop --ignore --cidfile=%t/%n.ctr-id</span>
        <span class="s">ExecStopPost=/usr/bin/podman rm -f --ignore --cidfile=%t/%n.ctr-id</span>
        <span class="s">Type=notify</span>
        <span class="s">NotifyAccess=all</span>

        <span class="s">[Install]</span>
        <span class="s">WantedBy=multi-user.target default.target</span>
</code></pre></div></div>

<ul>
  <li>å°†<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶è½¬ä¸º <code class="language-plaintext highlighter-rouge">ign</code> æ ¼å¼</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ butane <span class="nt">--pretty</span> <span class="nt">--strict</span> fcos36.yml <span class="nt">--output</span> fcos36.ign 
</code></pre></div></div>

<ul>
  <li>å°†<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶å­˜æ”¾åœ¨ Web ç«™ç‚¹å¯¹åº”çš„ç›®å½•ä¸‹</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ <span class="nb">sudo cp </span>fcos36.ign /var/www/html/ign/
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•æ–‡ä»¶æ˜¯å¦èƒ½è®¿é—®</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-19-12.png" alt="" /></p>

<h3 id="4-ä½¿ç”¨ignitionæ–‡ä»¶å¼€å§‹éƒ¨ç½²-fcos">4. ä½¿ç”¨<code class="language-plaintext highlighter-rouge">ignition</code>æ–‡ä»¶å¼€å§‹éƒ¨ç½² FCOS</h3>

<ul>
  <li>åœ¨FCOSçš„è™šæ‹Ÿæœºä¸­æ‰§è¡Œå‘½ä»¤</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>core@localhost ~]<span class="nv">$ </span><span class="nb">exit</span>    <span class="c"># å¦‚æœçœ‹ä¸åˆ°å®‰è£…å¸®åŠ©å‘½ä»¤ï¼Œå¯å…ˆæ‰§è¡Œ `exit` </span>
<span class="o">[</span>core@localhost ~]<span class="nv">$ </span><span class="nb">sudo </span>coreos-installer <span class="nb">install</span> /dev/sda <span class="se">\</span>
                    <span class="nt">--ignition-url</span> http://172.25.254.228:8080/ign/fcos36.ign <span class="se">\</span>
                    <span class="nt">--insecure-ignition</span>
</code></pre></div></div>
<hr />
<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-22-44.png" alt="" /></p>

<hr />
<ul>
  <li>å®‰è£…ç»“æŸï¼Œé‡å¯ç³»ç»Ÿ</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-27-07.png" alt="" /></p>

<ul>
  <li>ç™»å½•ç•Œé¢</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-29-17.png" alt="" /></p>

<h3 id="5-è¿œç¨‹è¿æ¥å¹¶éªŒè¯ç»“æœ">5. è¿œç¨‹è¿æ¥å¹¶éªŒè¯ç»“æœ</h3>

<ul>
  <li>ä½¿ç”¨ SSH ç§é’¥è¿›è¡Œè¿æ¥</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”ŒğŸ’  devops @ ğŸ’»  workstation <span class="k">in</span> ğŸ“  ~
â””â¯ ssh <span class="nt">-i</span> ~/.ssh/id_rsa core@172.25.254.221
The authenticity of host <span class="s1">'172.25.254.221 (172.25.254.221)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:RmfcSQncM52Z6pn8acIrpXjsLpw167fDyiSjVKHCy0I.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>172.25.254.221<span class="s1">' (ED25519) to the list of known hosts.
Fedora CoreOS 37.20230122.3.0
Tracker: https://github.com/coreos/fedora-coreos-tracker
Discuss: https://discussion.fedoraproject.org/tag/coreos

[core@fcos ~]$ 
</span></code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹ç£ç›˜åˆ†åŒº</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>core@fcos ~]<span class="nv">$ </span>lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda      8:0    0   20G  0 disk 
â”œâ”€sda1   8:1    0    1M  0 part 
â”œâ”€sda2   8:2    0  127M  0 part 
â”œâ”€sda3   8:3    0  384M  0 part /boot
â”œâ”€sda4   8:4    0    8G  0 part /sysroot/ostree/deploy/fedora-coreos/var
â”‚                               /usr
â”‚                               /etc
â”‚                               /
â”‚                               /sysroot
â””â”€sda5   8:5    0 11.5G  0 part /var/lib/containers/storage/overlay
                                /var
</code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹ç½‘ç»œé…ç½®</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>core@fcos ~]<span class="nv">$ </span><span class="nb">hostname
</span>fcos.xwanli0923.github.io
<span class="o">[</span>core@fcos ~]<span class="nv">$ </span>ip addr show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:0c:29:d0:c3:a7 brd ff:ff:ff:ff:ff:ff
    altname enp3s0
    inet 172.25.254.221/24 brd 172.25.254.255 scope global dynamic noprefixroute ens160
       valid_lft 151sec preferred_lft 151sec
    inet6 fe80::6f14:2875:e850:8fd9/64 scope <span class="nb">link </span>noprefixroute 
       valid_lft forever preferred_lft forever
3: podman0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    <span class="nb">link</span>/ether ce:16:23:ac:2f:1d brd ff:ff:ff:ff:ff:ff
    inet 10.88.0.1/16 brd 10.88.255.255 scope global podman0
       valid_lft forever preferred_lft forever
    inet6 fe80::9c82:7aff:fec2:5025/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
4: veth0@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master podman0 state UP group default qlen 1000
    <span class="nb">link</span>/ether 32:35:08:f9:a6:c3 brd ff:ff:ff:ff:ff:ff link-netns netns-a5949274-3549-2bb7-7ce9-36465802458e
    inet6 fe80::3035:8ff:fef9:a6c3/64 scope <span class="nb">link 
       </span>valid_lft forever preferred_lft forever
</code></pre></div></div>

<ul>
  <li>æ£€æŸ¥å®¹å™¨</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>core@fcos ~]<span class="nv">$ </span><span class="nb">sudo </span>podman ps 
CONTAINER ID  IMAGE                           COMMAND           CREATED        STATUS            PORTS               NAMES
3cec19adf88f  docker.io/library/httpd:latest  httpd-foreground  6 minutes ago  Up 6 minutes ago  0.0.0.0:80-&gt;80/tcp  mywebserver
</code></pre></div></div>

<ul>
  <li>å®¢æˆ·ç«¯è®¿é—®</li>
</ul>

<p><img src="/assets/images/2023-02-20/Snipaste_2023-02-20_16-39-59.png" alt="" /></p>

<hr />

<p><em>å‚è€ƒæ–‡æ¡£ï¼š</em>
<em>- <a href="https://docs.fedoraproject.org/en-US/fedora-coreos/bare-metal/">Fedora CoreOSè£¸é‡‘å±å®‰è£…</a></em></p>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="linux container cloud-native" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">ä½¿ç”¨Kickstartè‡ªåŠ¨åŒ–éƒ¨ç½²Linuxæ“ä½œç³»ç»Ÿ</title><link href="http://localhost:4000/2023/02/13/Install-Linux-Using-Kickstart.html" rel="alternate" type="text/html" title="ä½¿ç”¨Kickstartè‡ªåŠ¨åŒ–éƒ¨ç½²Linuxæ“ä½œç³»ç»Ÿ" /><published>2023-02-13T00:00:00+08:00</published><updated>2023-02-13T00:00:00+08:00</updated><id>http://localhost:4000/2023/02/13/Install-Linux-Using-Kickstart</id><content type="html" xml:base="http://localhost:4000/2023/02/13/Install-Linux-Using-Kickstart.html"><![CDATA[<p><img src="/assets/images/2023-02-13/800px-DSC_3217.JPG" alt="Fedoraject-Anaconda-installer" /></p>

<p><em>[å›¾ç‰‡æ¥æºï¼š<a href="https://fedoraproject.org/wiki/File:DSC_3217.JPG">Fedora Wiki</a> ]</em></p>

<p><em>ä½œè€…: é‚¢ä¸‡é‡Œ</em></p>

<h1 id="æ–‡æ¡£è¯´æ˜">æ–‡æ¡£è¯´æ˜</h1>

<p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ <strong>Kickstart</strong> å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½² <strong>Linux</strong> æ“ä½œç³»ç»Ÿ</p>

<ul>
  <li>ç³»ç»Ÿç‰ˆæœ¬: AlmaLinux 9.1</li>
  <li>ä¸»æœºå: hub.xwanli0923.github.io</li>
</ul>

<h1 id="å‡†å¤‡é˜¶æ®µ">å‡†å¤‡é˜¶æ®µ</h1>

<h3 id="1-éƒ¨ç½²httpæœåŠ¡å™¨">1. éƒ¨ç½²HTTPæœåŠ¡å™¨</h3>

<ul>
  <li>
    <p>åœ¨å·²ç»å®Œæˆå®‰è£…çš„ <strong>AlmaLinux</strong> ä¸­ï¼Œå…ˆé…ç½®ä¸€ä¸ªæœ¬åœ° YUM ä»“åº“ï¼Œä¾¿äºå®‰è£… <code class="language-plaintext highlighter-rouge">httpd</code> è½¯ä»¶åŒ…</p>
  </li>
  <li>
    <p>å…ˆå°†ç³»ç»Ÿå…‰ç›˜æŒ‚è½½åˆ° <code class="language-plaintext highlighter-rouge">/mnt</code>ç›®å½•ä¸‹</p>
  </li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span>lsblk 
NAME                   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda                      8:0    0   50G  0 disk 
â”œâ”€sda1                   8:1    0  600M  0 part /boot/efi
â”œâ”€sda2                   8:2    0    1G  0 part /boot
â””â”€sda3                   8:3    0 48.4G  0 part 
  â””â”€cloudshelledu-root 253:0    0   47G  0 lvm  /
sr0                     11:0    1    8G  0 rom  
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>mount /dev/sr0 /mnt
mount: /mnt: WARNING: <span class="nb">source </span>write-protected, mounted read-only.
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">df</span> <span class="nt">-Th</span> /mnt
Filesystem     Type     Size  Used Avail Use% Mounted on
/dev/sr0       iso9660  8.1G  8.1G     0 100% /mnt
</code></pre></div></div>

<ul>
  <li>ç¼–å†™ YUM ä»“åº“æ–‡ä»¶</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo ls</span> /mnt
AppStream  BaseOS  EFI	images	isolinux  LICENSE  media.repo  TRANS.TBL

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>

<span class="o">[</span>root@hub.xwanli0923.github.io ~]# <span class="nb">cat</span> <span class="o">&gt;</span> /etc/yum.repos.d/almalinux_dvd.repo <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
&gt; [almalinux-9.1-for-x86_64-BaseOS-rpms]
&gt; name = AlmaLinux DVD BaseOS Local Repository
&gt; enabled = true
&gt; baseurl = file:///mnt/BaseOS
&gt; gpgcheck = false
&gt; 
&gt; [almalinux-9.1-for-x86_64-AppStream-rpms]
&gt; name = AlmaLinux DVD AppStream Local Repository
&gt; enabled = true
&gt; baseurl = file:///mnt/AppStream
&gt; gpgcheck = false
&gt; EOF

[root@hub.xwanli0923.github.io ~]# exit
</span></code></pre></div></div>

<ul>
  <li>ç¦ç”¨é»˜è®¤çš„è½¯ä»¶ä»“åº“(å¯é€‰)</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf repolist
repo <span class="nb">id                                                                 </span>repo name
almalinux-9.1-for-x86_64-AppStream-rpms                                 AlmaLinux DVD AppStream Local Repository
almalinux-9.1-for-x86_64-BaseOS-rpms                                    AlmaLinux DVD BaseOS Local Repository
appstream                                                               AlmaLinux 9 - AppStream
baseos                                                                  AlmaLinux 9 - BaseOS
extras                                                                  AlmaLinux 9 - Extras

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf config-manager <span class="nt">--disable</span> appstream
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf config-manager <span class="nt">--disable</span> baseos
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf config-manager <span class="nt">--disable</span> extras
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf repolist
repo <span class="nb">id                                                                 </span>repo name
almalinux-9.1-for-x86_64-AppStream-rpms                                 AlmaLinux DVD AppStream Local Repository
almalinux-9.1-for-x86_64-BaseOS-rpms                                    AlmaLinux DVD BaseOS Local Repository

</code></pre></div></div>

<ul>
  <li>å…³é—­ <code class="language-plaintext highlighter-rouge">SELinux</code></li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/SELINUX=enforcing/SELINUX=permissive/g'</span> /etc/selinux/config 

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>setenforce permissive
</code></pre></div></div>

<h3 id="2-é…ç½®åŸºäºhttpçš„yumä»“åº“">2. é…ç½®åŸºäºHTTPçš„YUMä»“åº“</h3>

<ul>
  <li>
    <p>å®‰è£…å¹¶é…ç½® <code class="language-plaintext highlighter-rouge">httpd</code> æœåŠ¡ï¼Œç”¨äºå®‰è£…æœŸé—´æ‰€éœ€çš„è½¯ä»¶åŒ…æä¾›YUMä»“åº“</p>
  </li>
  <li>
    <p>å®‰è£… <code class="language-plaintext highlighter-rouge">httpd</code> æœåŠ¡</p>
  </li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf <span class="nb">install </span>httpd <span class="nt">-y</span>
</code></pre></div></div>

<ul>
  <li>åˆ›å»ºå†…å®¹ç›®å½•</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /content/almalinux/<span class="o">{</span>dvd,ks<span class="o">}</span>
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo ln</span> <span class="nt">-s</span> /content /var/www/html/
</code></pre></div></div>

<ul>
  <li>å…è®¸é˜²ç«å¢™é€šè¿‡ <code class="language-plaintext highlighter-rouge">http</code> æµé‡</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--add-service</span><span class="o">=</span>http 
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--runtime-to-permanent</span>
</code></pre></div></div>

<ul>
  <li>è¿è¡Œ<code class="language-plaintext highlighter-rouge">httpd</code>æœåŠ¡å¹¶å…è®¸å¼€æœºè‡ªåŠ¨è¿è¡Œ</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>httpd <span class="nt">--now</span>
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span>ss <span class="nt">-tplna</span> | <span class="nb">grep</span> :80
LISTEN 0      511                 <span class="k">*</span>:80              <span class="k">*</span>:<span class="k">*</span>  
</code></pre></div></div>

<ul>
  <li>å®¢æˆ·ç«¯æµ‹è¯•</li>
</ul>

<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-13_16-06-49.png" alt="" /></p>

<ul>
  <li>å°†å…‰ç›˜æ–‡ä»¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ°<code class="language-plaintext highlighter-rouge">/content/almalinux/dvd</code>ä¸­</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>rsync <span class="nt">-rP</span> /mnt/<span class="k">*</span>   /content/almalinux/dvd/
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹æœ¬åœ°çš„YUMä»“åº“é…ç½®æ–‡ä»¶</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'s/mnt/content\/almalinux\/dvd/g'</span> /etc/yum.repos.d/almalinux_dvd.repo 
</code></pre></div></div>

<h3 id="3-éƒ¨ç½²-dhcp-æœåŠ¡å™¨">3. éƒ¨ç½² DHCP æœåŠ¡å™¨</h3>

<ul>
  <li>å®‰è£… <code class="language-plaintext highlighter-rouge">dhcp</code> è½¯ä»¶åŒ…</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf <span class="nb">install </span>dhcp-server <span class="nt">-y</span>
</code></pre></div></div>

<ul>
  <li>é…ç½® <code class="language-plaintext highlighter-rouge">dhcpd</code> æœåŠ¡</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span>rpm <span class="nt">-ql</span> dhcp-server | <span class="nb">grep </span>example
/usr/share/doc/dhcp-server/dhcpd.conf.example
/usr/share/doc/dhcp-server/dhcpd6.conf.example

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo cp</span> /usr/share/doc/dhcp-server/dhcpd.conf.example  /etc/dhcp/dhcpd.conf
</code></pre></div></div>

<ul>
  <li>ç¼–è¾‘ <code class="language-plaintext highlighter-rouge">dhcpd.conf</code> æ–‡ä»¶</li>
</ul>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">option</span> <span class="err">space</span> <span class="err">pxelinux</span><span class="c">;
</span><span class="err">option</span> <span class="err">pxelinux.magic</span> <span class="err">code</span> <span class="py">208</span> <span class="p">=</span> <span class="s">string;</span>
<span class="err">option</span> <span class="err">pxelinux.configfile</span> <span class="err">code</span> <span class="py">209</span> <span class="p">=</span> <span class="s">text;</span>
<span class="err">option</span> <span class="err">pxelinux.pathprefix</span> <span class="err">code</span> <span class="py">210</span> <span class="p">=</span> <span class="s">text;</span>
<span class="err">option</span> <span class="err">pxelinux.reboottime</span> <span class="err">code</span> <span class="py">211</span> <span class="p">=</span> <span class="s">unsigned integer 32;</span>
<span class="err">option</span> <span class="err">architecture-type</span> <span class="err">code</span> <span class="py">93</span> <span class="p">=</span> <span class="s">unsigned integer 16;</span>

<span class="err">subnet</span> <span class="err">172.16.100.0</span> <span class="err">netmask</span> <span class="err">255.255.255.0</span> <span class="err">{</span>

        <span class="err">class</span> <span class="err">"virtual"</span> <span class="err">{</span>
                <span class="err">match</span> <span class="err">if</span> <span class="err">substring</span> <span class="err">(hardware,</span> <span class="err">1,</span> <span class="err">3)</span> <span class="err">=</span> <span class="err">52:54:00</span> <span class="err">or</span>
                     <span class="err">substring</span> <span class="err">(hardware,</span> <span class="err">1,</span> <span class="err">3)</span> <span class="err">=</span> <span class="err">00:16:3e</span> <span class="err">or</span>
                     <span class="err">substring</span> <span class="err">(hardware,</span> <span class="err">1,</span> <span class="err">3)</span> <span class="err">=</span> <span class="err">00:16:36</span><span class="c">;
</span>        <span class="err">}</span>

        <span class="err">class</span> <span class="err">"microsoft-clients"</span> <span class="err">{</span>
                <span class="err">match</span> <span class="err">if</span> <span class="err">substring(option</span> <span class="err">vendor-class-identifier,0,4)</span> <span class="err">=</span> <span class="err">"MSFT"</span><span class="c">;
</span>        <span class="err">}</span>

        <span class="err">class</span> <span class="err">"pxeclients"</span> <span class="err">{</span>
                <span class="err">match</span> <span class="err">if</span> <span class="err">substring(option</span> <span class="err">vendor-class-identifier,</span> <span class="err">0,</span> <span class="err">9)</span> <span class="err">=</span> <span class="err">"PXEClient"</span><span class="c">;
</span>
                <span class="err">next-server</span> <span class="err">172.16.100.100</span><span class="c">;
</span>                <span class="err">option</span> <span class="err">tftp-server-name</span> <span class="err">"172.16.100.100"</span><span class="c">;
</span>                <span class="err">if</span> <span class="err">option</span> <span class="py">architecture-type</span> <span class="p">=</span> <span class="s">00:07 {</span>
                        <span class="c"># UEFI SYSTEMS
</span>                        <span class="err">filename</span> <span class="err">"BOOTX64.EFI"</span><span class="c">;
</span>                <span class="err">}</span> <span class="err">else</span> <span class="err">{</span>
                        <span class="c"># EVERYBODY ELSE (BIOS)
</span>                        <span class="err">filename</span> <span class="err">"pxelinux.0"</span><span class="c">;
</span>                <span class="err">}</span>
        <span class="err">}</span>


        <span class="err">option</span> <span class="err">routers</span> <span class="err">172.16.100.1</span><span class="c">;
</span>        <span class="err">option</span> <span class="err">subnet-mask</span> <span class="err">255.255.255.0</span><span class="c">;
</span>        <span class="err">option</span> <span class="err">domain-name-servers</span> <span class="err">172.16.100.100</span><span class="c">;
</span>        <span class="err">default-lease-time</span> <span class="err">21600</span><span class="c">;
</span>        <span class="err">max-lease-time</span> <span class="err">86400</span><span class="c">;
</span>
        <span class="c"># Assign IPs 201-220 to PXE clients
</span>        <span class="err">pool</span> <span class="err">{</span>
                <span class="err">deny</span> <span class="err">members</span> <span class="err">of</span> <span class="err">"virtual"</span><span class="c">;
</span>                <span class="err">allow</span> <span class="err">members</span> <span class="err">of</span> <span class="err">"pxeclients"</span><span class="c">;
</span>                <span class="err">default-lease-time</span> <span class="err">120</span><span class="c">;
</span>                <span class="err">max-lease-time</span> <span class="err">180</span><span class="c">;
</span>                <span class="err">range</span> <span class="err">172.16.100.201</span> <span class="err">172.16.100.220</span><span class="c">;
</span>        <span class="err">}</span>
        <span class="err">pool</span> <span class="err">{</span>
                <span class="err">deny</span> <span class="err">members</span> <span class="err">of</span> <span class="err">"virtual"</span><span class="c">;
</span>                <span class="err">default-lease-time</span> <span class="err">120</span><span class="c">;
</span>                <span class="err">max-lease-time</span> <span class="err">180</span><span class="c">;
</span>                <span class="err">range</span> <span class="err">172.16.100.101</span> <span class="err">172.16.100.200</span><span class="c">;
</span>        <span class="err">}</span>

<span class="err">}</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">dhcpd</code> æœåŠ¡å¹¶å¼€æœºè¿è¡Œ</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>dhcpd <span class="nt">--now</span>

<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl status dhcpd
â— dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/dhcpd.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
     Active: active <span class="o">(</span>running<span class="o">)</span> since Tue 2023-02-14 00:39:35 CST<span class="p">;</span> 5s ago
       Docs: man:dhcpd<span class="o">(</span>8<span class="o">)</span>
             man:dhcpd.conf<span class="o">(</span>5<span class="o">)</span>
   Main PID: 28022 <span class="o">(</span>dhcpd<span class="o">)</span>
     Status: <span class="s2">"Dispatching packets..."</span>
      Tasks: 1 <span class="o">(</span>limit: 24580<span class="o">)</span>
     Memory: 5.2M
        CPU: 11ms
     CGroup: /system.slice/dhcpd.service
             â””â”€28022 /usr/sbin/dhcpd <span class="nt">-f</span> <span class="nt">-cf</span> /etc/dhcp/dhcpd.conf <span class="nt">-user</span> dhcpd <span class="nt">-group</span> dhcpd <span class="nt">--no-pid</span>

Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Database file: /var/lib/dhcpd/dhcpd.leases
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: PID file: /var/run/dhcpd.pid
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Source compiled to use binary-leases
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Wrote 0 class decls to leases file.
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Wrote 0 leases to leases file.
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Listening on LPF/ens160/00:0c:29:12:6a:60/172.16.100.0/24
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Sending on   LPF/ens160/00:0c:29:12:6a:60/172.16.100.0/24
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Sending on   Socket/fallback/fallback-net
Feb 14 00:39:35 hub.xwanli0923.github.io dhcpd[28022]: Server starting service.
Feb 14 00:39:35 hub.xwanli0923.github.io systemd[1]: Started DHCPv4 Server Daemon.
</code></pre></div></div>

<ul>
  <li>æ·»åŠ  <code class="language-plaintext highlighter-rouge">dhcp</code> æœåŠ¡é€šè¿‡é˜²ç«å¢™è§„åˆ™</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--add-service</span><span class="o">=</span>dhcp 
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--runtime-to-permanent</span>
</code></pre></div></div>

<h3 id="4-å‡†å¤‡-tftp-æœåŠ¡å™¨">4. å‡†å¤‡ TFTP æœåŠ¡å™¨</h3>

<ul>
  <li>å®‰è£… TFTP æœåŠ¡å™¨</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf <span class="nb">install </span>tftp-server
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">tftp</code> æœåŠ¡å™¨å¹¶å…è®¸å¼€æœºè‡ªåŠ¨è¿è¡Œ</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>tftp.socket <span class="nt">--now</span>
</code></pre></div></div>

<ul>
  <li>æ·»åŠ  <code class="language-plaintext highlighter-rouge">tftp</code> æœåŠ¡é€šè¿‡é˜²æŠ¤å¢™è§„åˆ™</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--add-service</span><span class="o">=</span>tftp
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>firewall-cmd <span class="nt">--runtime-to-permanent</span>
</code></pre></div></div>

<h3 id="5-å‡†å¤‡è‡ªåŠ¨åº”ç­”æ–‡ä»¶kickstart">5. å‡†å¤‡è‡ªåŠ¨åº”ç­”æ–‡ä»¶kickstart</h3>

<ul>
  <li>
    <p>kickstart æ–‡ä»¶ç”Ÿæˆå¯ä»¥ä½¿ç”¨å½“å‰ç³»ç»Ÿ <code class="language-plaintext highlighter-rouge">/root/anaconda-ks.cfg</code> è¿›è¡Œä¿®æ”¹ï¼Œæˆ–è€…ä½¿ç”¨çº¢å¸½çš„ <a href="https://access.redhat.com/labs/kickstartconfig/">Kickstart Generator</a> ç”Ÿæˆ</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">kickstart</code>è‡ªåŠ¨åº”ç­”æ–‡ä»¶è¯­æ³•å¯å‚è€ƒï¼š
    <ul>
      <li><a href="https://pykickstart.readthedocs.io/en/latest/kickstart-docs.html#what-are-kickstart-installations">https://pykickstart.readthedocs.io/en/latest/kickstart-docs.html#what-are-kickstart-installations</a></li>
    </ul>
  </li>
  <li>
    <p>æœ¬ç¤ºä¾‹é‡‡ç”¨å‚è€ƒæ–‡æ¡£ä»¥åŠåŸæœ‰æ–‡ä»¶ä¿®æ”¹ç”Ÿæˆ</p>
  </li>
  <li>æ–‡ä»¶ä½ç½® <code class="language-plaintext highlighter-rouge">/content/almalinux/ks/install.ks</code></li>
</ul>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">lang</span> <span class="err">en_US</span>
<span class="err">keyboard</span> <span class="py">--xlayouts</span><span class="p">=</span><span class="s">'us'</span>
<span class="err">timezone</span> <span class="err">Asia/Shanghai</span> <span class="err">--utc</span>
<span class="err">repo</span> <span class="py">--name</span><span class="p">=</span><span class="s">"AppStream"</span> <span class="s">--baseurl=http://172.16.100.100/content/almalinux/dvd/AppStream</span>
<span class="err">%addon</span> <span class="err">com_redhat_dump</span> <span class="err">--disable</span>
<span class="err">%end</span>
<span class="err">network</span>  <span class="py">--bootproto</span><span class="p">=</span><span class="s">dhcp --device=link --activate</span>
<span class="err">rootpw</span> <span class="err">$2b$10$8yIFVJWpMRASzobheELgT.BZFZQ/Ubu1IysRiYWu95BqEI/4zCYsW</span> <span class="err">--iscrypted</span>
<span class="c"># The xwanli's password is `cloudshelledu`
</span><span class="err">user</span> <span class="py">--groups</span><span class="p">=</span><span class="s">wheel --name=xwanli --password=$6$XZTVGyVbdYxk9wh6$uDcnyVxqJjig90bc7.ti7S5PVTDFk7G3xyix/JT0/9p4KVnUN7EU8VJR5hOjAGcoztca3d4aydvYyTcYDE0Zy1 --iscrypted --gecos="xwanli"</span>
<span class="err">reboot</span>
<span class="err">text</span>
<span class="err">url</span> <span class="py">--url</span><span class="p">=</span><span class="s">http://172.16.100.100/content/almalinux/dvd/BaseOS</span>
<span class="err">bootloader</span> <span class="py">--append</span><span class="p">=</span><span class="s">"rhgb quiet"</span>
<span class="err">zerombr</span>
<span class="err">clearpart</span> <span class="err">--all</span> <span class="err">--initlabel</span>
<span class="err">part</span> <span class="err">pv.0</span> <span class="py">--fstype</span><span class="p">=</span><span class="s">"lvmpv"</span> <span class="s">--ondisk=sda --size=10240 --grow</span>
<span class="err">part</span> <span class="err">/boot</span> <span class="py">--fstype</span><span class="p">=</span><span class="s">"xfs"</span> <span class="s">--ondisk=sda --size=2048 </span>
<span class="err">volgroup</span> <span class="err">cloudshelledu</span> <span class="py">--pesize</span><span class="p">=</span><span class="s">4096 pv.0</span>
<span class="err">logvol</span> <span class="err">/</span> <span class="py">--fstype</span><span class="p">=</span><span class="s">"xfs"</span> <span class="s">--size=10240 --grow  --name=root --vgname=cloudshelledu</span>
<span class="err">part</span> <span class="err">/boot/efi</span> <span class="py">--fstype</span><span class="p">=</span><span class="s">efi --size=600 --fsoptions="umask=0077,shortname=winnt"</span>

<span class="err">firstboot</span> <span class="err">--disable</span>
<span class="err">auth</span> <span class="err">--enableshadow</span> <span class="py">--passalgo</span><span class="p">=</span><span class="s">sha512</span>
<span class="err">selinux</span> <span class="err">--permissive</span>
<span class="err">firewall</span> <span class="err">--enabled</span> <span class="err">--ssh</span>
<span class="err">skipx</span>
<span class="err">%post</span>
<span class="err">cat</span> <span class="err">&gt;</span> <span class="err">/etc/yum.repos.d/almalinux_dvd.repo</span> <span class="err">&lt;&lt;-EOF</span>
<span class="nn">[almalinux-9.1-for-x86_64-BaseOS-rpms]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">AlmaLinux DVD BaseOS Local Repository</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">baseurl</span> <span class="p">=</span> <span class="s">http://172.16.100.100/content/almalinux/dvd/BaseOS</span>
<span class="py">gpgcheck</span> <span class="p">=</span> <span class="s">false</span>

<span class="nn">[almalinux-9.1-for-x86_64-AppStream-rpms]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">AlmaLinux DVD AppStream Local Repository</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">baseurl</span> <span class="p">=</span> <span class="s">http://172.16.100.100/content/almalinux/dvd/AppStream</span>
<span class="py">gpgcheck</span> <span class="p">=</span> <span class="s">false</span>
<span class="err">EOF</span>
<span class="err">dnf</span> <span class="err">group</span> <span class="err">install</span> <span class="err">-y</span> <span class="err">"Server</span> <span class="err">with</span> <span class="err">GUI"</span>
<span class="err">dnf</span> <span class="err">remove</span> <span class="err">-y</span> <span class="err">gnome-initial-setup</span>
<span class="err">systemctl</span> <span class="err">set-default</span> <span class="err">graphical.target</span>
<span class="err">%end</span>

<span class="err">%packages</span>
<span class="err">@^graphical-server-environment</span>
<span class="err">@guest-agents</span>

<span class="err">%end</span>

</code></pre></div></div>

<h3 id="6-å‘-tftpä¸­æ·»åŠ æ‰€éœ€æ–‡ä»¶">6. å‘ <code class="language-plaintext highlighter-rouge">TFTP</code>ä¸­æ·»åŠ æ‰€éœ€æ–‡ä»¶</h3>

<ul>
  <li>å®‰è£… <code class="language-plaintext highlighter-rouge">TFTP Booting</code> æ–‡ä»¶,å¹¶æ‹·è´ <code class="language-plaintext highlighter-rouge">pxelinux.0</code>æ–‡ä»¶è‡³ <code class="language-plaintext highlighter-rouge">/var/lib/tftpboot</code></li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>dnf instal <span class="nt">-y</span> syslinux-tftpboot
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo cp</span> /tftpboot/pxelinux.0 /var/lib/tftpboot/
</code></pre></div></div>

<ul>
  <li>å°†å…‰ç›˜ä¸­æ‰€éœ€æ–‡ä»¶æ‹·è´è‡³<code class="language-plaintext highlighter-rouge">/var/lib.tftpboot</code></li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-r</span> /content/almalinux/dvd/EFI/BOOT/<span class="k">*</span>  /var/lib/tftpboot/
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-r</span> /content/almalinux/dvd/images /var/lib/tftpboot/
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo cp</span> <span class="nt">-r</span> /content/almalinux/dvd/isolinux/<span class="k">*</span>  /var/lib/tftpboot/
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹ <code class="language-plaintext highlighter-rouge">EFI</code> å¼•å¯¼æ—¶æ‰€éœ€çš„é…ç½®æ–‡ä»¶</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo </span>vim /var/lib/tftpboot/grub.cfg 
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo chmod </span>644 /var/lib/tftpboot/grub.cfg 
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">set</span> <span class="py">default</span><span class="p">=</span><span class="s">"1"</span>

<span class="err">function</span> <span class="err">load_video</span> <span class="err">{</span>
  <span class="err">insmod</span> <span class="err">efi_gop</span>
  <span class="err">insmod</span> <span class="err">efi_uga</span>
  <span class="err">insmod</span> <span class="err">video_bochs</span>
  <span class="err">insmod</span> <span class="err">video_cirrus</span>
  <span class="err">insmod</span> <span class="err">all_video</span>
<span class="err">}</span>

<span class="err">load_video</span>
<span class="err">set</span> <span class="py">gfxpayload</span><span class="p">=</span><span class="s">keep</span>
<span class="err">insmod</span> <span class="err">gzio</span>
<span class="err">insmod</span> <span class="err">part_gpt</span>
<span class="err">insmod</span> <span class="err">ext2</span>

<span class="err">set</span> <span class="py">timeout</span><span class="p">=</span><span class="s">60</span>
<span class="c">### END /etc/grub.d/00_header ###
</span>
<span class="err">search</span> <span class="err">--no-floppy</span> <span class="py">--set</span><span class="p">=</span><span class="s">root -l 'AlmaLinux-9-1-x86_64-dvd'</span>

<span class="c">### BEGIN /etc/grub.d/10_linux ###
</span><span class="err">menuentry</span> <span class="err">'Install</span> <span class="err">AlmaLinux</span> <span class="err">9.1</span> <span class="err">UEFI</span> <span class="err">from</span> <span class="err">hub.xwanli0923.github.io'</span> <span class="err">--class</span> <span class="err">fedora</span> <span class="err">--class</span> <span class="err">gnu-linux</span> <span class="err">--class</span> <span class="err">gnu</span> <span class="err">--class</span> <span class="err">os</span> <span class="err">{</span>
        <span class="err">linuxefi</span> <span class="err">/images/pxeboot/vmlinuz</span> <span class="py">inst.repo</span><span class="p">=</span><span class="s">http://172.16.100.100/content/almalinux/dvd/ inst.ks=http://172.16.100.100/content/almalinux/ks/install.ks quiet</span>
        <span class="err">initrdefi</span> <span class="err">/images/pxeboot/initrd.img</span>
<span class="err">}</span>
</code></pre></div></div>

<ul>
  <li>åˆ›å»º <code class="language-plaintext highlighter-rouge">Legacy</code> å¼•å¯¼æ‰€éœ€æ–‡ä»¶</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo mkdir</span> /var/lib/tftpboot/pxelinux.cfg
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo mv</span> /var/lib/tftpboot/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default
<span class="o">[</span>xwanli@hub.xwanli0923.github.io ~]<span class="nv">$ </span><span class="nb">sudo chmod </span>644 /var/lib/tftpboot/pxelinux.cfg/default
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">default</span> <span class="err">vesamenu.c32</span>
<span class="err">timeout</span> <span class="err">600</span>

<span class="err">display</span> <span class="err">boot.msg</span>
<span class="err">...ommit...</span>

<span class="err">menu</span> <span class="err">tabmsg</span> <span class="err">Press</span> <span class="err">Tab</span> <span class="err">for</span> <span class="err">full</span> <span class="err">configuration</span> <span class="err">options</span> <span class="err">on</span> <span class="err">menu</span> <span class="err">items.</span>

<span class="err">menu</span> <span class="err">separator</span> <span class="c"># insert an empty line
</span><span class="err">menu</span> <span class="err">separator</span> <span class="c"># insert an empty line
</span>
<span class="err">label</span> <span class="err">linux</span>
  <span class="err">menu</span> <span class="err">label</span> <span class="err">^Install</span> <span class="err">AlmaLinux</span> <span class="err">9.1</span> <span class="err">Legacy</span> <span class="err">from</span> <span class="err">hub.xwanli0923.github.io</span>
  <span class="err">kernel</span> <span class="err">vmlinuz</span>
  <span class="err">append</span> <span class="py">initrd</span><span class="p">=</span><span class="s">initrd.img inst.repo=http://172.16.100.100/content/almalinux/dvd/ inst.ks=http://172.16.100.100/content/almalinux/ks/install.ks quiet</span>


<span class="err">label</span> <span class="err">local</span>
  <span class="err">menu</span> <span class="err">label</span> <span class="err">Boot</span> <span class="err">from</span> <span class="err">^local</span> <span class="err">drive</span>
  <span class="err">localboot</span> <span class="err">0xffff</span>

<span class="err">menu</span> <span class="err">separator</span> <span class="c"># insert an empty line
</span>

<span class="err">menu</span> <span class="err">end</span>
</code></pre></div></div>

<h3 id="7-æµ‹è¯•éƒ¨ç½²">7. æµ‹è¯•éƒ¨ç½²</h3>

<ul>
  <li>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">UEFI</code> å¼•å¯¼</li>
</ul>

<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-13_17-41-42.png" alt="" /></p>

<hr />

<p><img src="/assets/images/2023-02-13/pxe-with-uefi-2023-02-14-10-47-38.png" alt="" /></p>

<ul>
  <li>å¼€æœºåä½¿ç”¨åˆ›å»ºçš„è´¦æˆ·<code class="language-plaintext highlighter-rouge">xwanli</code>ç™»å½•</li>
</ul>

<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-14_11-47-59.png" alt="" /></p>

<hr />

<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-14_11-50-24.png" alt="" /></p>

<ul>
  <li>ç™»å½•æˆåŠŸ</li>
</ul>

<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-14_11-51-09.png" alt="" /></p>

<hr />
<p><img src="/assets/images/2023-02-13/Snipaste_2023-02-14_11-53-17.png" alt="" /></p>

<h3 id="8-ç»“è¯­">8. ç»“è¯­</h3>

<p>æœ¬æ–‡ä¸»è¦ä»¥UEFIå¼•å¯¼çš„é…ç½®ä¸ºä¸»ï¼Œå¦‚æœéœ€è¦éƒ¨ç½²<code class="language-plaintext highlighter-rouge">Legacy MBR</code>çš„å¼•å¯¼æ¨¡å¼ï¼Œéœ€è¦æ‚¨å¯¹<code class="language-plaintext highlighter-rouge">kickstart</code>æ–‡ä»¶è¿›è¡Œè°ƒæ•´ï¼›æˆ–è€…ç¼–å†™ <code class="language-plaintext highlighter-rouge">%pre ... %end</code>éƒ¨åˆ†ï¼Œåˆ¤æ–­ç³»ç»Ÿå¼•å¯¼æ¨¡å¼ï¼Œä»è€Œè‡ªåŠ¨åˆ¤æ–­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">EUFI</code>æˆ–<code class="language-plaintext highlighter-rouge">Legacy MBR</code> ã€‚</p>

<hr />
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>

<ul>
  <li>PXELINUX Wiki: <a href="https://wiki.syslinux.org/wiki/index.php?title=PXELINUX#:~:text=DHCP%20options%20Option%20208%20pxelinux.magic%20Earlier%20versions%20of,able%20to%20recognize%20any%20special%20DHCP%20options%20whatsoever.">https://wiki.syslinux.org/wiki/index.php?title=PXELINUX</a></li>
  <li>RFC 2132: <a href="https://tools.ietf.org/html/rfc2132">DHCP Options and BOOTP Vendor Extensions</a></li>
  <li>RFC 4578: <a href="https://tools.ietf.org/html/rfc4578">DHCP Options for PXE</a></li>
  <li>RFC 5071: <a href="https://tools.ietf.org/html/rfc5071">DHCP Options used by PXELINUX</a></li>
</ul>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="linux" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">åœ¨çº¢å¸½ä¼ä¸šç‰ˆLinux9ä¸­å¦‚ä½•é‡ç½®ROOTå¯†ç </title><link href="http://localhost:4000/2022/12/25/reset-root-password.html" rel="alternate" type="text/html" title="åœ¨çº¢å¸½ä¼ä¸šç‰ˆLinux9ä¸­å¦‚ä½•é‡ç½®ROOTå¯†ç " /><published>2022-12-25T00:00:00+08:00</published><updated>2022-12-25T00:00:00+08:00</updated><id>http://localhost:4000/2022/12/25/reset-root-password</id><content type="html" xml:base="http://localhost:4000/2022/12/25/reset-root-password.html"><![CDATA[<p><img src="/assets/images/2022-12-25/rhel9-backlit-lines.jpg" alt="rhel9" /></p>

<p><em>[å›¾ç‰‡æ¥æºï¼šRHEL9 å†…ç½®å£çº¸]</em></p>

<p><em>ä½œè€…ï¼šé‚¢ä¸‡é‡Œ</em></p>

<h2 id="æ–‡æ¡£è¯´æ˜">æ–‡æ¡£è¯´æ˜ï¼š</h2>

<p>æœ¬æ–‡å™è¿°äº†å¦‚ä½•åœ¨æ²¡æœ‰å¯¹åº”ç‰ˆæœ¬çš„ç³»ç»ŸLiveCDè¿›å…¥æ•‘æ´æ¨¡å¼ä¸‹é‡ç½® <strong>root</strong> è´¦æˆ·å¯†ç çš„ä½¿ç”¨åœºæ™¯ã€‚</p>

<blockquote>
  <p>ç³»ç»Ÿç‰ˆæœ¬: Red Hat Enterprise Linux 9.0</p>

  <p>Kernel: 5.14.0-70.13.1.el9_0.x86_64</p>
</blockquote>

<h2 id="é‡ç½®-root-å¯†ç ">é‡ç½® ROOT å¯†ç </h2>

<ol>
  <li>
    <p>åœ¨è®¡ç®—æœºçš„æœ¬åœ°æ§åˆ¶å°ï¼Œå‘é€ <strong>Ctrl+Alt+Del</strong> ç»„åˆé”®æ¥é‡å¯ç³»ç»Ÿã€‚</p>
  </li>
  <li>
    <p>å½“æˆ‘ä»¬çœ‹åˆ°ç³»ç»Ÿå¼•å¯¼èœå•ç•Œé¢ï¼ŒæŒ‰ä¸‹ä»»æ„æŒ‰é”®ï¼ˆä¸åŒ…æ‹¬<strong>Enter</strong>)ä¸­æ­¢å€’è®¡æ—¶ã€‚</p>
  </li>
  <li>
    <p>ä½¿ç”¨æ–¹å‘æŒ‰é”®ç§»åŠ¨å…‰æ ‡åˆ°å½“å‰å†…æ ¸ç‰ˆæœ¬å¯¹åº”çš„ rescue æ¡ç›®:
<img src="/assets/images/2022-12-25/select-kernel-item.png" alt="select-kernel-item" /></p>

    <p>æ ¹æ®å±å¹•ä¸‹æ–¹çš„æç¤ºï¼ŒæŒ‰ä¸‹ <strong>e</strong> ç¼–è¾‘é€‰æ‹©çš„æ¡ç›®ï¼›å¦‚æœåœ¨ç¼–è¾‘é¡µé¢å‘ç”Ÿæ”¹å˜åï¼Œæƒ³è¦æ¢å¤é»˜è®¤å†…å®¹ï¼ŒæŒ‰ä¸‹<strong>Esc</strong>å›é€€åˆ°å½“å‰é¡µé¢èœå•ï¼Œé‡æ–°è¿›å…¥å³å¯ã€‚</p>
  </li>
  <li>
    <p>è¿›å…¥åˆ°ç¼–è¾‘é¡µé¢åï¼Œä½¿ç”¨æ–¹å‘é”®ç§»åŠ¨å…‰æ ‡ï¼Œæ‰¾åˆ° <strong>linux</strong> å¼€å¤´çš„ä¸€è¡Œï¼ŒæŒ‰ä¸‹ <strong>Ctrl+e</strong> æˆ–è€… <strong>End</strong> é”®ï¼Œæ¥åˆ°è¡Œå°¾ï¼Œè¾“å…¥ <strong>rd.break</strong> ï¼›è¿™å¯ä»¥ä½¿ç³»ç»Ÿä» <strong>initramfs</strong> å‘å®é™…ç³»ç»Ÿç§»äº¤æ§åˆ¶æƒå‰ä¸­æ–­å‰è¿›ã€‚
<img src="/assets/images/2022-12-25/kernel-command-line.png" alt="kernel-command-line" />
  æŒ‰ä¸‹ <strong>Ctrl+x</strong> ä½¿ç”¨å½“å‰æ›´æ”¹è¿›è¡Œå¯åŠ¨</p>
  </li>
  <li>
    <p>å¯åŠ¨ä¹‹åï¼Œç³»ç»Ÿä¼šè¿›å…¥ <strong>emergency mode</strong>, å¹¶æç¤ºæŒ‰ä¸‹ <strong>Enter</strong> è¿›å…¥ç»´æŠ¤,æŒ‰ä¸‹ <strong>Enter</strong> æŒ‰é”®ï¼š
<img src="/assets/images/2022-12-25/chroot-jail.png" alt="chroot-jail" /></p>
  </li>
  <li>åœ¨å½“å‰çš„ <strong>shell (switch_root)</strong> ç¯å¢ƒä¸­ï¼Œç£ç›˜ä¸Šçš„ç³»ç»Ÿæ ¹ç›®å½•ä¼šä»¥åªè¯»çš„æ–¹å¼æŒ‚è½½åœ¨ <strong>/sysroot</strong> ã€‚æˆ‘ä»¬åœ¨ä¿®æ”¹å¯†ç æ—¶éœ€è¦æ›´æ–° <strong>/etc/shadow</strong> æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°† <strong>sysroot</strong> ç›®å½•é‡æ–°ä»¥è¯»å†™æƒé™è¿›è¡ŒæŒ‚è½½ï¼š
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mount <span class="nt">-o</span> remount,rw /sysroot
</code></pre></div>    </div>
  </li>
  <li>ä½¿ç”¨ <strong>chroot</strong> å‘½ä»¤åˆ‡æ¢ç³»ç»Ÿæ ¹ç›®å½•åˆ° <strong>/sysroot</strong> ï¼Œ<strong>/sysroot</strong> æ˜¯æˆ‘ä»¬ç³»ç»ŸçœŸå®çš„æ ¹ç›®å½•ï¼š
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chroot</span> /sysroot
</code></pre></div>    </div>
  </li>
  <li>åˆ‡æ¢æˆåŠŸå ï¼Œè®¾ç½®æ–°çš„å¯†ç :
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>passwd root
</code></pre></div>    </div>
  </li>
  <li>æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å¼€å¯äº† <strong>SELinux</strong>ï¼Œå¦‚æœå¼€å¯ï¼Œä¸Šè¿°æ›´æ”¹ä¼šå¯¼è‡´ç³»ç»Ÿåœ¨ä¸‹æ¬¡å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦åˆ›å»º <strong>/.autorelabel</strong> æ–‡ä»¶ï¼Œé€šçŸ¥ç³»ç»Ÿåœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ï¼Œç¡®ä¿æ‰€æœ‰æœªæ ‡è®°æ–‡ä»¶èƒ½å¤Ÿé‡æ–°è·å¾— <strong>SELinux</strong> å®‰å…¨ä¸Šä¸‹æ–‡æ ‡ç­¾:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">grep</span> ^SELINUX<span class="o">=</span> /etc/selinux/config
<span class="nv">SELINUX</span><span class="o">=</span>enforcing
<span class="nv">$ </span><span class="nb">touch</span> /.autorelabel
</code></pre></div>    </div>
  </li>
  <li>
    <p>è¾“å…¥ <strong>exit</strong> å‘½ä»¤é€€å‡ºå½“å‰ <strong>chroot</strong> ç¯å¢ƒ ,å¹¶å†æ¬¡è¾“å…¥ <strong>exit</strong> å‘½ä»¤é€€å‡º <strong>initramfs</strong> è°ƒè¯• <strong>shell</strong> ã€‚</p>
  </li>
  <li>ç³»ç»Ÿå°†è‡ªåŠ¨é‡å¯ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡å¯ä»¥çœ‹åˆ° <strong>login</strong> ç™»å½•æç¤ºï¼Œè¾“å…¥ <strong>root</strong> è´¦æˆ·å’Œå¯¹åº”æ–°å¯†ç ç™»å½•ç³»ç»Ÿã€‚</li>
</ol>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="linux" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">å¼€å§‹éƒ¨ç½² CEPH é›†ç¾¤</title><link href="http://localhost:4000/2022/12/21/deploying-ceph-cluster.html" rel="alternate" type="text/html" title="å¼€å§‹éƒ¨ç½² CEPH é›†ç¾¤" /><published>2022-12-21T00:00:00+08:00</published><updated>2022-12-21T00:00:00+08:00</updated><id>http://localhost:4000/2022/12/21/deploying-ceph-cluster</id><content type="html" xml:base="http://localhost:4000/2022/12/21/deploying-ceph-cluster.html"><![CDATA[<p><img src="/assets/images/2022-12-21/photo-jelly-fish-01.jpg" alt="Ceph" />
<em>[å›¾ç‰‡æ¥æº ceph.io]</em></p>

<p><em>ä½œè€…ï¼šé‚¢ä¸‡é‡Œ</em></p>

<h2 id="æ–‡æ¡£è¯´æ˜">æ–‡æ¡£è¯´æ˜</h2>

<ul>
  <li>ç³»ç»Ÿç‰ˆæœ¬ï¼šCentOS-Stream-8-x86_64-20221125</li>
  <li>å†…æ ¸ç‰ˆæœ¬ï¼š4.18.0-408</li>
  <li>podman ç‰ˆæœ¬:4.2.0</li>
  <li>ceph ç‰ˆæœ¬ï¼š Quincy</li>
  <li>å®¢æˆ·ç«¯é…ç½®ï¼š
    <ul>
      <li><strong>ceph-clienta</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
          <li>Storage: 10GiBx5</li>
        </ul>
      </li>
      <li><strong>ceph-clientb</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>é›†ç¾¤èŠ‚ç‚¹é…ç½®ï¼š
    <ul>
      <li><strong>ceph-serverc</strong>ã€<strong>ceph-serverd</strong>å’Œ<strong>ceph-servere</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
          <li>Storage: 10GiBx5</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="æŸ¥æ‰¾åˆé€‚çš„é•œåƒ">æŸ¥æ‰¾åˆé€‚çš„é•œåƒ</h2>

<ol>
  <li>ä»¥ <strong>admin</strong> èº«ä»½ç™»å½• <strong>ceph-serverc</strong>, ä½¿ç”¨ <strong>cephadm</strong> éªŒè¯å½“å‰çš„ç‰ˆæœ¬
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
<span class="nv">$ </span>cephadm version
Using ceph image with <span class="nb">id</span> <span class="s1">'cc65afd6173a'</span> and tag <span class="s1">'v17'</span> created on 2022-10-17 23:41:41 +0000 UTC
quay.io/ceph/ceph@sha256:0560b16bec6e84345f29fb6693cd2430884e6efff16a95d5bdd0bb06d7661c45
ceph version 17.2.5 <span class="o">(</span>98318ae89f1a893a6ded3a640405cdbb33e08757<span class="o">)</span> quincy <span class="o">(</span>stable<span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>æˆ‘ä»¬å¯ä»¥åœ¨ <a href="https://quay.io/repository/ceph/ceph">quay.io</a> å’Œ <a href="https://hub.docker.com/r/ceph/ceph">docker.io</a>è·å¾— <strong>ceph</strong> ç›¸å…³çš„å¯ç”¨é•œåƒï¼Œä½†æ˜¯ <strong>docker hub</strong> ä¸Šçš„é•œåƒæ›´æ–°é€Ÿåº¦æœ‰å¯èƒ½æ¯” <strong>quay.io</strong> çš„æ…¢ï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©ä½¿ç”¨ <strong>quay.io</strong> çš„é•œåƒæ–‡ä»¶:
    <ul>
      <li>å®‰è£… <strong>jq</strong> å·¥å…·
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dnf <span class="nb">install </span>jq 
</code></pre></div>        </div>
      </li>
      <li>æŸ¥æ‰¾é•œåƒä»“åº“ä¸­å¯ç”¨çš„é•œåƒç‰ˆæœ¬
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-ddds</span> <span class="nt">-L</span> https://quay.io/api/v1/repository/ceph/ceph/tag?page_size<span class="o">=</span>100 | jq <span class="s1">'."tags"[] .name'</span> | <span class="nb">grep</span> <span class="s1">'17.*'</span>
<span class="s2">"v17.2"</span>
<span class="s2">"v17"</span>
<span class="s2">"v17.2.5"</span>
....ommit....
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h2 id="å‡†å¤‡è¿›è¡Œéƒ¨ç½²">å‡†å¤‡è¿›è¡Œéƒ¨ç½²</h2>

<ol>
  <li>åˆ›å»ºä¸€ä¸ª <strong>JSON</strong> æ–‡ä»¶ä¿æŠ¤æ•æ„Ÿä¿¡æ¯,ä¾‹å¦‚ä¸º <strong>auth.json</strong>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mdkir /root/ceph-cluster
<span class="nv">$ </span><span class="nb">cd</span> /root/ceph-cluster
<span class="nv">$ </span><span class="nb">cat </span>auth.json
<span class="o">{</span>
<span class="s2">"url"</span>:<span class="s2">"quay.io"</span>,
<span class="s2">"username"</span>:<span class="s2">"YOUR QUAY ACCOUNT"</span>,
<span class="s2">"password"</span>:<span class="s2">"YOUR QUAY ACCOUNT PASSWORD"</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>è¿è¡Œ <strong>cephadm bootstrap</strong> å‘½ä»¤åˆ›å»ºä¸€ä¸ªcephé›†ç¾¤
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># man cephadm  | grep -A 29 'cephadm bootstrap'</span>
<span class="nv">$ </span>cephadm bootstrap <span class="nt">--cluster-network</span> 172.16.90.0/24 <span class="se">\</span>
<span class="nt">--mon-ip</span> 172.16.80.104 <span class="se">\</span>
<span class="nt">--initial-dashboard-password</span> YOUR_PASSWORD <span class="se">\</span>
<span class="nt">--dashboard-password-noupdate</span> <span class="se">\</span>
<span class="nt">--allow-fqdn-hostname</span> <span class="se">\</span>
<span class="nt">--registry-json</span> auth.json
   
   
Ceph Dashboard is now available at:
   
             URL: https://ceph-serverc.lab.example.net:8443/
            User: admin
        Password: YOUR_PASSWORD
   
Enabling client.admin keyring and conf on hosts with <span class="s2">"admin"</span> label
Saving cluster configuration to /var/lib/ceph/5851a2e4-80f0-11ed-9d85-000c291c7df8/config directory
Enabling autotune <span class="k">for </span>osd_memory_target
You can access the Ceph CLI as following <span class="k">in case</span> of multi-cluster or non-default config:
   
        <span class="nb">sudo</span> /usr/sbin/cephadm shell <span class="nt">--fsid</span> 5851a2e4-80f0-11ed-9d85-000c291c7df8 <span class="nt">-c</span> /etc/ceph/ceph.conf <span class="nt">-k</span> /etc/ceph/ceph.client.admin.keyring
   
Or, <span class="k">if </span>you are only running a single cluster on this host:
   
        <span class="nb">sudo</span> /usr/sbin/cephadm shell
   
Please consider enabling telemetry to <span class="nb">help </span>improve Ceph:
   
        ceph telemetry on
   
For more information see:
   
        https://docs.ceph.com/docs/master/mgr/telemetry/
   
Bootstrap complete.
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="éªŒè¯ç»“æœ">éªŒè¯ç»“æœ</h2>

<ol>
  <li>éªŒè¯é›†ç¾¤çŠ¶æ€
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cephadm shell <span class="nt">--</span> ceph <span class="nt">-s</span>
Inferring fsid 5851a2e4-80f0-11ed-9d85-000c291c7df8
Inferring config /var/lib/ceph/5851a2e4-80f0-11ed-9d85-000c291c7df8/mon.ceph-serverc.lab.example.net/config
Using ceph image with <span class="nb">id</span> <span class="s1">'cc65afd6173a'</span> and tag <span class="s1">'v17'</span> created on 2022-10-17 23:41:41 +0000 UTC
quay.io/ceph/ceph@sha256:0560b16bec6e84345f29fb6693cd2430884e6efff16a95d5bdd0bb06d7661c45
  cluster:
    <span class="nb">id</span>:     5851a2e4-80f0-11ed-9d85-000c291c7df8
    health: HEALTH_WARN
            OSD count 0 &lt; osd_pool_default_size 3
   
  services:
    mon: 1 daemons, quorum ceph-serverc.lab.example.net <span class="o">(</span>age 3m<span class="o">)</span>
    mgr: ceph-serverc.lab.example.net.erqjrd<span class="o">(</span>active, since 2m<span class="o">)</span>
    osd: 0 osds: 0 up, 0 <span class="k">in
   
  </span>data:
    pools:   0 pools, 0 pgs
    objects: 0 objects, 0 B
    usage:   0 B used, 0 B / 0 B avail
    pgs:
</code></pre></div>    </div>
  </li>
  <li>è®¿é—®å…¶<code class="language-plaintext highlighter-rouge">dashboard</code>
    <ul>
      <li>
        <p>åœ¨æµè§ˆå™¨è¾“å…¥ <em>https://ceph-serverc.lab.example.net:8443</em> æˆ– <em>https://172.16.80.104:8443</em>ï¼Œå¼¹å‡ºçš„è¯ä¹¦è­¦å‘ŠåŒæ„å³å¯
<img src="/assets/images/2022-12-21/ceph-dashboard.png" alt="ceph dashboard" /></p>
      </li>
      <li>
        <p>è¾“å…¥è´¦æˆ·<code class="language-plaintext highlighter-rouge">admin</code>å’Œè®¾ç½®çš„å¯†ç ï¼Œå°†ä¼šçœ‹åˆ°æ¦‚è§ˆç•Œé¢
<img src="/assets/images/2022-12-21/ceph-dashboard-initial.png" alt="ceph dashboard expand cluster" />
<img src="/assets/images/2022-12-21/ceph-dashboard-overview.png" alt="ceph dashboard expand cluster" /></p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="å¢åŠ ä¸»æœºå’Œè®¾å¤‡">å¢åŠ ä¸»æœºå’Œè®¾å¤‡</h2>

<ol>
  <li>å®‰è£…é›†ç¾¤å…¬å…±SSHå…¬é’¥
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ceph cephadm get-pub-key <span class="o">&gt;</span> /root/ceph-cluster/ceph-cluster.pub
<span class="nv">$ </span> <span class="k">for </span>HOSTS <span class="k">in </span>ceph-<span class="o">{</span>clienta,clientb,serverc,serverd,servere<span class="o">}</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">do </span>ssh-copy-id <span class="nt">-f</span> <span class="nt">-i</span> /root/ceph-cluster/ceph-cluster.pub root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span><span class="p">;</span> <span class="se">\</span>
    <span class="k">done</span>
</code></pre></div>    </div>
  </li>
  <li>æ·»åŠ æ–°çš„ä¸»æœºåˆ°é›†ç¾¤
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ceph orch host add ceph-clienta.lab.example.net
Added host <span class="s1">'ceph-clienta.lab.example.net'</span> with addr <span class="s1">'172.16.80.102'</span>
   
<span class="nv">$ </span>ceph orch host add ceph-serverc.lab.example.net
Added host <span class="s1">'ceph-serverc.lab.example.net'</span> with addr <span class="s1">'172.16.80.104'</span>
   
<span class="nv">$ </span>ceph orch host add ceph-serverd.lab.example.net
Added host <span class="s1">'ceph-serverd.lab.example.net'</span> with addr <span class="s1">'172.16.80.105'</span>
   
<span class="nv">$ </span>ceph orch host add ceph-servere.lab.example.net
Added host <span class="s1">'ceph-servere.lab.example.net'</span> with addr <span class="s1">'172.16.80.106'</span>
</code></pre></div>    </div>
  </li>
  <li>å¢åŠ æ–°çš„ OSD
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ceph orch daemon add osd ceph-serverc.lab.example.net:/dev/sdb
Created osd<span class="o">(</span>s<span class="o">)</span> 0 on host <span class="s1">'ceph-serverc.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-serverc.lab.example.net:/dev/sdc
Created osd<span class="o">(</span>s<span class="o">)</span> 1 on host <span class="s1">'ceph-serverc.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-serverc.lab.example.net:/dev/sdd
Created osd<span class="o">(</span>s<span class="o">)</span> 2 on host <span class="s1">'ceph-serverc.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-serverd.lab.example.net:/dev/sdb
Created osd<span class="o">(</span>s<span class="o">)</span> 3 on host <span class="s1">'ceph-serverd.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-serverd.lab.example.net:/dev/sdc
Created osd<span class="o">(</span>s<span class="o">)</span> 4 on host <span class="s1">'ceph-serverd.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-serverd.lab.example.net:/dev/sdd
Created osd<span class="o">(</span>s<span class="o">)</span> 5 on host <span class="s1">'ceph-serverd.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-servere.lab.example.net:/dev/sdb
Created osd<span class="o">(</span>s<span class="o">)</span> 6 on host <span class="s1">'ceph-servere.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-servere.lab.example.net:/dev/sdc
Created osd<span class="o">(</span>s<span class="o">)</span> 7 on host <span class="s1">'ceph-servere.lab.example.net'</span>
   
<span class="nv">$ </span>ceph orch daemon add osd ceph-servere.lab.example.net:/dev/sdd
Created osd<span class="o">(</span>s<span class="o">)</span> 8 on host <span class="s1">'ceph-servere.lab.example.net'</span>
</code></pre></div>    </div>
  </li>
  <li>æœ€ç»ˆçš„ <strong>ceph</strong> é›†ç¾¤çŠ¶æ€
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cephadm shell
Inferring fsid 5851a2e4-80f0-11ed-9d85-000c291c7df8
Inferring config /var/lib/ceph/5851a2e4-80f0-11ed-9d85-000c291c7df8/mon.ceph-serverc.lab.example.net/config
Using ceph image with <span class="nb">id</span> <span class="s1">'cc65afd6173a'</span> and tag <span class="s1">'v17'</span> created on 2022-10-17 23:41:41 +0000 UTC
quay.io/ceph/ceph@sha256:0560b16bec6e84345f29fb6693cd2430884e6efff16a95d5bdd0bb06d7661c45
<span class="o">[</span>ceph: root@ceph-serverc /]# ceph <span class="nt">-s</span>
  cluster:
    <span class="nb">id</span>:     5851a2e4-80f0-11ed-9d85-000c291c7df8
    health: HEALTH_OK
   
  services:
    mon: 4 daemons, quorum ceph-serverc.lab.example.net,ceph-clienta,ceph-serverd,ceph-servere <span class="o">(</span>age 6m<span class="o">)</span>
    mgr: ceph-serverc.lab.example.net.erqjrd<span class="o">(</span>active, since 25m<span class="o">)</span>, standbys: ceph-clienta.kbhjvx
    osd: 9 osds: 9 up <span class="o">(</span>since 110s<span class="o">)</span>, 9 <span class="k">in</span> <span class="o">(</span>since 2m<span class="o">)</span>
   
  data:
    pools:   1 pools, 1 pgs
    objects: 2 objects, 577 KiB
    usage:   591 MiB used, 89 GiB / 90 GiB avail
    pgs:     1 active+clean
</code></pre></div>    </div>

    <p><img src="/assets/images/2022-12-21/ceph-dashboard-new-view.png" alt="dashboard new view" /></p>
  </li>
</ol>

<hr />
<blockquote>
  <p>å‚è€ƒæ–‡æ¡£ï¼š<br />
ceph-container: <a href="https://github.com/ceph/ceph-container/blob/main/README.md">https://github.com/ceph/ceph-container</a> <br />
Ceph Document: <a href="https://docs.ceph.com/en/latest/cephadm/host-management/#cephadm-adding-hosts">cephadm-adding-hosts</a></p>
</blockquote>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="ceph" /><summary type="html"><![CDATA[[å›¾ç‰‡æ¥æº ceph.io]]]></summary></entry><entry><title type="html">éƒ¨ç½²CEPHé›†ç¾¤å‰çš„å‡†å¤‡å·¥ä½œ</title><link href="http://localhost:4000/2022/12/19/preparing-for-ceph-cluster-deployment.html" rel="alternate" type="text/html" title="éƒ¨ç½²CEPHé›†ç¾¤å‰çš„å‡†å¤‡å·¥ä½œ" /><published>2022-12-19T00:00:00+08:00</published><updated>2022-12-19T00:00:00+08:00</updated><id>http://localhost:4000/2022/12/19/preparing-for-ceph-cluster-deployment</id><content type="html" xml:base="http://localhost:4000/2022/12/19/preparing-for-ceph-cluster-deployment.html"><![CDATA[<p><img src="/assets/images/2022-12-19/photo-squid-02.jpg" alt="Ceph" />
<em>[å›¾ç‰‡æ¥æº ceph.io]</em></p>

<p><em>ä½œè€…ï¼šé‚¢ä¸‡é‡Œ</em></p>

<h2 id="æ–‡æ¡£è¯´æ˜">æ–‡æ¡£è¯´æ˜</h2>

<ul>
  <li>ç³»ç»Ÿç‰ˆæœ¬ï¼šCentOS-Stream-8-x86_64-20221125</li>
  <li>å†…æ ¸ç‰ˆæœ¬ï¼š4.18.0-408</li>
  <li>podman ç‰ˆæœ¬:4.2.0</li>
  <li>ceph ç‰ˆæœ¬ï¼š Quincy</li>
  <li>å…¶ä»–è¦æ±‚ï¼š <strong>git</strong>ã€<strong>LVM2</strong>ã€<strong>python3.6.8</strong></li>
  <li>å®¢æˆ·ç«¯é…ç½®ï¼š
    <ul>
      <li><strong>ceph-clienta</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
          <li>Storage: 10GiBx5</li>
        </ul>
      </li>
      <li><strong>ceph-clientb</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><em>ceph-clienta å……å½“cephé›†ç¾¤å®¢æˆ·ç«¯çš„åŒæ—¶ï¼Œä¹Ÿå……å½“cephçš„ç®¡ç†ç«¯</em></p>

<ul>
  <li>é›†ç¾¤èŠ‚ç‚¹é…ç½®ï¼š
    <ul>
      <li><strong>ceph-serverc</strong>ã€<strong>ceph-serverd</strong>å’Œ<strong>ceph-servere</strong>
        <ul>
          <li>CPU: 2vCPU</li>
          <li>Memory: 4GiB</li>
          <li>Storage: 10GiBx5</li>
        </ul>
      </li>
    </ul>

    <p><em>å…¶ä¸­ ceph-server å±äº bootstrap èŠ‚ç‚¹</em></p>
  </li>
  <li>
    <p>ç½‘ç»œä¿¡æ¯ï¼š</p>

    <p><strong>public_network</strong>: 172.16.80.0/24</p>

    <p><strong>cluster_network</strong>: 172.16.90.0/24</p>
  </li>
</ul>

<h2 id="å®‰è£…-cephadm">å®‰è£… CEPHADM</h2>

<ol>
  <li>ä½¿ç”¨ <strong>root</strong> è´¦æˆ·ç™»å½•åˆ° <strong>ceph-serverc</strong> èŠ‚ç‚¹
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dnf <span class="nb">install</span> <span class="nt">-y</span> centos-release-ceph-quincy
<span class="nv">$ </span>dnf <span class="nb">install</span> <span class="nt">-y</span> cephadm vim bash-completion git ansible
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="è®¾ç½®ç³»ç»Ÿ">è®¾ç½®ç³»ç»Ÿ</h2>

<ol>
  <li>åœ¨ <strong>ceph-clientc</strong> åˆ›å»º <strong>admin</strong> è´¦æˆ·ï¼Œå¹¶è®¾ç½®å…¶ä¸ºå…è®¤è¯ <strong>SUDO</strong>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>useradd admin
<span class="nv">$ </span>passwd admin
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"admin ALL=(ALL) NOPASSWD:ALL"</span> <span class="o">&gt;</span> /etc/sudoers.d/admin
<span class="nv">$ </span><span class="nb">chmod </span>0400 /etc/sudoers.d/admin
</code></pre></div>    </div>
  </li>
  <li>åœ¨ <strong>ceph-clientc</strong> ä¸Šåˆ›å»ºå…å¯†ç è®¤è¯çš„ <strong>ssh</strong> å¯†é’¥å¯¹ï¼Œå¹¶å¤åˆ¶åˆ° <strong>admin</strong> å®¶ç›®å½•
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ssh-keygen <span class="nt">-q</span> <span class="nt">-t</span> rsa <span class="nt">-f</span> ~/.ssh/id_rsa <span class="nt">-N</span> <span class="s1">''</span>
<span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> ~/.ssh  ~admin/.ssh
<span class="nv">$ </span><span class="nb">chown</span> <span class="nt">-R</span> admin: ~admin/.ssh
<span class="nv">$ </span>ssh-copy-id root@localhost
</code></pre></div>    </div>
  </li>
  <li>æ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œç¼–å†™æœ¬åœ°ä¸»æœºåè§£ææ–‡ä»¶ <strong>/etc/hosts</strong>,è¿½åŠ ä»¥ä¸‹å†…å®¹
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>172.16.80.102 ceph-clienta.lab.example.net ceph-clienta
172.16.80.103 ceph-clientb.lab.example.net ceph-clientb
172.16.80.104 ceph-serverc.lab.example.net ceph-serverc
172.16.80.105 ceph-serverd.lab.example.net ceph-serverd
172.16.80.106 ceph-servere.lab.example.net ceph-servere
</code></pre></div>    </div>
  </li>
  <li>å°†ä¸Šè¿°åˆ›å»ºçš„ç”¨æˆ·ï¼Œæ–‡ä»¶ç­‰åœ¨å…¶ä»–èŠ‚ç‚¹åŒæ ·åˆ›å»º
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="k">for </span>HOSTS <span class="k">in </span>ceph-<span class="o">{</span>clienta,clientb,serverc,serverd,servere<span class="o">}</span>
  <span class="k">do
   </span>scp <span class="nt">-r</span> /root/.ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:/root/.ssh
   scp  /etc/hosts root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:/etc/hosts
   ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span> <span class="s2">"useradd admin"</span>
   ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span> <span class="s2">"echo YOUR_ADMIN_PASSWORD | passwd --stdin admin"</span>
   scp /etc/sudoers.d/admin root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:/etc/sudoers.d/admin
   ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span> <span class="s2">"chmod 0400 /etc/sudoers.d/admin"</span>
   scp <span class="nt">-r</span> /root/.ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:/home/admin/.ssh
   ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span> <span class="s2">"chown -R admin: /home/admin/.ssh"</span>
  <span class="k">done</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="å‡†å¤‡-cephadm-ansible">å‡†å¤‡ cephadm-ansible</h2>

<ol>
  <li>ä½¿ç”¨ <strong>git clone</strong> å‘½ä»¤ä¸‹è½½ <strong>cephadm-ansible</strong>:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone <span class="nt">-b</span> quincy https://github.com/ceph/cephadm-ansible.git
<span class="nv">$ </span><span class="nb">cd </span>cephadm-ansible/
</code></pre></div>    </div>
  </li>
  <li>åœ¨ <strong>cephadm-adnible</strong> ä¸‹åˆ›å»º <strong>hosts</strong> æ¸…å•æ–‡ä»¶:
    <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">ceph-clienta.lab.example.net</span>
<span class="err">ceph-clientb.lab.example.net</span>
<span class="err">ceph-serverc.lab.example.net</span>
<span class="err">ceph-serverd.lab.example.net</span>
<span class="err">ceph-servere.lab.example.net</span>
   
<span class="nn">[clients]</span>
<span class="err">ceph-clienta.lab.example.net</span>
<span class="err">ceph-clientb.lab.example.net</span>
   
<span class="nn">[admin]</span>
<span class="err">ceph-clienta.lab.example.net</span>
</code></pre></div>    </div>
  </li>
  <li>æµ‹è¯•æ¸…å•ä¸­çš„ä¸»æœºï¼Œå¹¶æ‰§è¡Œ <strong>cephadm-preflight.yml</strong>
    <ul>
      <li>æµ‹è¯•ä¸»æœºçš„è¿é€šæ€§å’Œç”¨æˆ·
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ansible <span class="nt">-i</span> hosts <span class="nt">--list-hosts</span> all
  hosts <span class="o">(</span>4<span class="o">)</span>:
     ceph-serverc.lab.example.net
     ceph-serverd.lab.example.net
     ceph-servere.lab.example.net
     ceph-clienta.lab.example.net
     ceph-clientb.lab.example.net
       
<span class="nv">$ </span>ansible <span class="nt">-i</span> hosts <span class="nt">-m</span> ping all
<span class="nv">$ </span>ansible all <span class="nt">-i</span> hosts  <span class="nt">-u</span> admin <span class="nt">-b</span> <span class="nt">-m</span> ping
</code></pre></div>        </div>
      </li>
      <li>æŸ¥çœ‹ <strong>cephadm-preflight.yml</strong>
        <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Usage:</span>
<span class="c1">#</span>
<span class="c1"># ansible-playbook -i &lt;inventory host file&gt; cephadm-preflight.yml</span>
<span class="c1">#</span>
<span class="c1"># You can limit the execution to a set of hosts by using `--limit` option:</span>
<span class="c1">#</span>
<span class="c1"># ansible-playbook -i &lt;inventory host file&gt; cephadm-preflight.yml --limit &lt;my_osd_group|my_node_name&gt;</span>
<span class="c1">#</span>
<span class="c1"># You can override variables using `--extra-vars` parameter:</span>
<span class="c1">#</span>
<span class="c1"># ansible-playbook -i &lt;inventory host file&gt; cephadm-preflight.yml --extra-vars "ceph_origin=rhcs"</span>
<span class="c1">#</span>
</code></pre></div>        </div>
      </li>
      <li>ä½¿ç”¨ <strong>â€“extra-vars â€œceph_origin=communityâ€</strong> æ‰§è¡Œ <strong>cephadm-preflight.yml</strong>
        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> ansible-playbook <span class="nt">-i</span> hosts <span class="nt">--extra-vars</span> <span class="s2">"ceph_origin=community"</span> cephadm-preflight.yml
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h2 id="è®¾ç½®é»˜è®¤ç™»å½•è´¦æˆ·å¯é€‰">è®¾ç½®é»˜è®¤ç™»å½•è´¦æˆ·(å¯é€‰)</h2>

<ol>
  <li>åœ¨ <strong>root</strong> å’Œ <strong>admin</strong> çš„ <strong>$HOME/.ssh/config</strong> ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹(æ²¡æœ‰åˆ™åˆ›å»ºè¯¥æ–‡ä»¶)ï¼š
    <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">Host</span> <span class="err">*.lab.example.net</span>
  <span class="err">User</span> <span class="err">root</span>
  <span class="err">StrictHostKeyChecking</span> <span class="err">no</span>
  <span class="err">UserKnownHostsFile</span> <span class="err">/dev/null</span>
</code></pre></div>    </div>
  </li>
  <li>å°†ä¸Šè¿°æ–‡ä»¶åˆ†åˆ«å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„å¯¹åº”ç”¨æˆ·å®¶ç›®å½•ä¸­ï¼š
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="k">for </span>HOSTS <span class="k">in </span>ceph-<span class="o">{</span>clienta,clientb,serverc,serverd,servere<span class="o">}</span>
 <span class="k">do
    </span>scp /root/.ssh/config root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:~/.ssh/config
    scp /home/admin/.ssh/config admin@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span>:~/.ssh/config
    ssh root@<span class="k">${</span><span class="nv">HOSTS</span><span class="k">}</span> <span class="s2">"systemctl disable firewalld.service --now"</span>
 <span class="k">done</span>
</code></pre></div>    </div>
  </li>
</ol>

<hr />
<blockquote>
  <p>å‚è€ƒæ–‡æ¡£ï¼š<br />
Ceph  Document: <a href="https://docs.ceph.com/en/latest/cephadm/install/#distribution-specific-installations">distribution-specific-installations</a> <br />
cephadm-ansible Document: <a href="https://github.com/ceph/cephadm-ansible/blob/devel/README.md">https://github.com/ceph/cephadm-ansible</a></p>
</blockquote>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="ceph" /><summary type="html"><![CDATA[[å›¾ç‰‡æ¥æº ceph.io]]]></summary></entry><entry><title type="html">å¦‚ä½•å¸è½½ Ansible Tower</title><link href="http://localhost:4000/2022/11/29/how-to-uninstall-ansible-tower.html" rel="alternate" type="text/html" title="å¦‚ä½•å¸è½½ Ansible Tower" /><published>2022-11-29T00:00:00+08:00</published><updated>2022-11-29T00:00:00+08:00</updated><id>http://localhost:4000/2022/11/29/how-to-uninstall-ansible-tower</id><content type="html" xml:base="http://localhost:4000/2022/11/29/how-to-uninstall-ansible-tower.html"><![CDATA[<p><img src="https://nwzimg.wezhan.cn/contents/sitefiles2033/10168677/images/38319670.jpg" alt="Ansible" /></p>

<p></p>

<ul>
  <li>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">ansible-tower-service stop</code> å‘½ä»¤åœæ­¢ Ansible ç›¸å…³æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">ansible-tower-service status</code>  å‘½ä»¤ç¡®ä¿æœåŠ¡å·²ç»åœæ­¢æˆåŠŸã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ansible-tower-service stop
Stopping Tower
Redirecting to /bin/systemctl stop rh-postgresql10-postgresql.service
Redirecting to /bin/systemctl stop rabbitmq-server.service
Redirecting to /bin/systemctl stop nginx.service
Redirecting to /bin/systemctl stop supervisord.service
</code></pre></div>    </div>
  </li>
  <li>å°† <code class="language-plaintext highlighter-rouge">/etc/ansible</code> å’Œ <code class="language-plaintext highlighter-rouge">/etc/tower</code> ç›®å½•è¿›è¡Œå½’æ¡£ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-cf</span> ansible.tar /etc/ansible
<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-cf</span> tower.tar   /etc/tower
</code></pre></div>    </div>
  </li>
  <li>å¦å¤–ï¼Œå‡è®¾æ‚¨å·²ç»ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">setup.sh</code> å®‰è£…äº† Ansible Tower,ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¤‡ä»½ Ansible Towerã€‚è¿™æ ·ä½ å¯ä»¥åœ¨é‡æ–°å®‰è£… Ansible Tower åä½¿ç”¨ <code class="language-plaintext highlighter-rouge">setup.sh -r &lt;backup file&gt;</code> å‘½ä»¤è¿›è¡Œè¿˜åŸã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>setup.sh <span class="nt">-b</span>
</code></pre></div>    </div>
  </li>
  <li>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">yum remove</code> å‘½ä»¤å¸è½½ <code class="language-plaintext highlighter-rouge">Ansible</code>ï¼Œ<code class="language-plaintext highlighter-rouge">RabbitMQ</code> å’Œ <code class="language-plaintext highlighter-rouge">Python</code>ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum remove ansible-tower<span class="k">*</span>
<span class="nv">$ </span>yum remove rabbitmq-server
<span class="nv">$ </span>yum remove rh-python36-<span class="k">*</span>
</code></pre></div>    </div>
  </li>
  <li>åˆ é™¤ <code class="language-plaintext highlighter-rouge">Postgres</code> è„šæœ¬ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">rm</span> /etc/profile.d/rh-postgresql10-env.sh
</code></pre></div>    </div>
  </li>
  <li>åˆ é™¤ä»¥ä¸‹ç›®å½•ã€‚
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /etc/ansible
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /etc/tower
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/pgsql
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/awx
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/rabbitmq
<span class="nv">$ </span><span class="nb">rm</span> <span class="nt">-rf</span> /var/opt/rh/rh-postgresql10/lib/pgsql/data
</code></pre></div>    </div>
  </li>
  <li>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">yum clean</code> å‘½ä»¤æ¸…é™¤ <code class="language-plaintext highlighter-rouge">Ansible Tower</code> è½¯ä»¶ä»“åº“
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum clean metadata <span class="nt">--enablerepo</span><span class="o">=</span><span class="s2">"ansible-tower,ansible-tower-dependencies"</span>
</code></pre></div>    </div>
  </li>
  <li>ç¡®ä¿ <code class="language-plaintext highlighter-rouge">rpm</code> å‘½ä»¤æ²¡æœ‰è¾“å‡º
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rpm <span class="nt">-qa</span> | <span class="nb">grep </span>ansible-tower
</code></pre></div>    </div>
    <hr />
    <blockquote>
      <p>æ¥æºï¼š<a href="http://www.freekb.net/Article?id=212">http://www.freekb.net/Article?id=212</a> <br />
ç¿»è¯‘ï¼š é‚¢ä¸‡é‡Œ</p>
    </blockquote>
  </li>
</ul>]]></content><author><name>é‚¢ä¸‡é‡Œ</name></author><category term="ansible" /><summary type="html"><![CDATA[]]></summary></entry></feed>